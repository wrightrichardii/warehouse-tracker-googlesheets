<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Pallet Tracker - Google Sheets Sync</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // REPLACE THIS URL WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        // Instructions: See GOOGLE-SHEETS-SETUP.md file
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxmCo0hgn9EUcTDNOn6fKIExckbhgRvbwoZlyXlhxVVogTJjmIQAhuO9XY5SVaWcWYkNw/exec';
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide Icons
        const Package = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16.5 9.4 7.55 4.24"></path>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.29 7 12 12 20.71 7"></polyline>
                <line x1="12" y1="22" x2="12" y2="12"></line>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const ArrowRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
        );

        const Lock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        );

        const Unlock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
            </svg>
        );

        const ArrowUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="19" x2="12" y2="5"></line>
                <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
        );

        const ArrowDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
        );

        const BarChart3 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 3v18h18"></path>
                <path d="M18 17V9"></path>
                <path d="M13 17V5"></path>
                <path d="M8 17v-3"></path>
            </svg>
        );

        function WarehousePalletTracker() {
            const COLS = 20;
            const ROWS = 10;
            
            const [stacks, setStacks] = useState(
                Array(ROWS * COLS).fill(null).map((_, i) => {
                    const row = Math.floor(i / COLS) + 1;
                    const col = i % COLS + 1;
                    return {
                        id: i + 1,
                        name: `R${row}-C${col}`,
                        row,
                        col,
                        pallets: [],
                        isBlocked: false
                    };
                })
            );
            
            const [showAddModal, setShowAddModal] = useState(false);
            const [selectedStack, setSelectedStack] = useState(null);
            const [newPalletContent, setNewPalletContent] = useState('');
            const [selectedPosition, setSelectedPosition] = useState('bottom');
            const [showMoveModal, setShowMoveModal] = useState(false);
            const [palletToMove, setPalletToMove] = useState(null);
            const [showMoveStackModal, setShowMoveStackModal] = useState(false);
            const [stackToMove, setStackToMove] = useState(null);
            const [selectedStackView, setSelectedStackView] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [lastSync, setLastSync] = useState(null);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [errorMessage, setErrorMessage] = useState('');
            const [showSummary, setShowSummary] = useState(false);
            
            const isUpdatingFromSheet = useRef(false);
            const syncIntervalRef = useRef(null);

            // Load data from Google Sheets
            const loadFromSheet = async () => {
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getData');
                    const result = await response.json();
                    
                    if (result.success) {
                        // Update connection status regardless of whether there's data
                        setLastSync(new Date().toLocaleTimeString());
                        setConnectionStatus('connected');
                        setErrorMessage('');
                        
                        // Only update stacks if there's actual data
                        if (result.data) {
                            isUpdatingFromSheet.current = true;
                            setStacks(result.data);
                            setTimeout(() => {
                                isUpdatingFromSheet.current = false;
                            }, 100);
                        }
                    } else {
                        setConnectionStatus('error');
                        setErrorMessage('Failed to load data from Google Sheets.');
                    }
                } catch (error) {
                    console.error('Error loading from sheet:', error);
                    setConnectionStatus('error');
                    setErrorMessage('Unable to connect to Google Sheets. Check your setup.');
                } finally {
                    setIsLoading(false);
                }
            };

            // Save data to Google Sheets
            const saveToSheet = async (data) => {
                if (isUpdatingFromSheet.current) return;
                
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'saveData',
                            data: data
                        })
                    });
                    
                    setLastSync(new Date().toLocaleTimeString());
                    setConnectionStatus('connected');
                } catch (error) {
                    console.error('Error saving to sheet:', error);
                    setConnectionStatus('error');
                }
            };

            // Initial load
            useEffect(() => {
                if (GOOGLE_SCRIPT_URL === 'PASTE_YOUR_SCRIPT_URL_HERE') {
                    setIsLoading(false);
                    setConnectionStatus('error');
                    setErrorMessage('‚ö†Ô∏è Please update GOOGLE_SCRIPT_URL in the HTML file. See setup instructions.');
                    return;
                }
                
                loadFromSheet();
                
                // Poll for updates every 3 seconds
                syncIntervalRef.current = setInterval(loadFromSheet, 3000);
                
                return () => {
                    if (syncIntervalRef.current) {
                        clearInterval(syncIntervalRef.current);
                    }
                };
            }, []);

            // Save when stacks change
            useEffect(() => {
                if (!isLoading && !isUpdatingFromSheet.current && connectionStatus === 'connected') {
                    saveToSheet(stacks);
                }
            }, [stacks, isLoading, connectionStatus]);

            const addPallet = () => {
                if (!newPalletContent.trim() || !selectedStack) return;
                
                const stack = stacks.find(s => s.id === selectedStack);
                if (stack.isBlocked) {
                    alert('This stack is blocked');
                    return;
                }
                if (stack.pallets.length >= 3) {
                    alert('Maximum stack height reached (3 pallets)');
                    return;
                }

                const newPallet = { 
                    id: Date.now(), 
                    content: newPalletContent,
                    addedAt: new Date().toLocaleString()
                };

                const updatedStacks = stacks.map(s => {
                    if (s.id !== selectedStack) return s;
                    
                    const updatedPallets = [...s.pallets];
                    
                    if (selectedPosition === 'bottom') {
                        updatedPallets.unshift(newPallet);
                    } else if (selectedPosition === 'middle') {
                        updatedPallets.splice(1, 0, newPallet);
                    } else {
                        updatedPallets.push(newPallet);
                    }
                    
                    return { ...s, pallets: updatedPallets };
                });
                
                setStacks(updatedStacks);
                setNewPalletContent('');
                setSelectedPosition('bottom');
                setShowAddModal(false);
                
                if (selectedStackView?.id === selectedStack) {
                    setSelectedStackView(updatedStacks.find(s => s.id === selectedStack));
                }
            };

            const movePalletInStack = (stackId, palletId, direction) => {
                const updatedStacks = stacks.map(s => {
                    if (s.id !== stackId) return s;
                    
                    const palletIndex = s.pallets.findIndex(p => p.id === palletId);
                    if (palletIndex === -1) return s;
                    
                    const newPallets = [...s.pallets];
                    
                    if (direction === 'up') {
                        if (palletIndex >= newPallets.length - 1) return s;
                        [newPallets[palletIndex], newPallets[palletIndex + 1]] = 
                        [newPallets[palletIndex + 1], newPallets[palletIndex]];
                    } else {
                        if (palletIndex <= 0) return s;
                        [newPallets[palletIndex], newPallets[palletIndex - 1]] = 
                        [newPallets[palletIndex - 1], newPallets[palletIndex]];
                    }
                    
                    return { ...s, pallets: newPallets };
                });
                
                setStacks(updatedStacks);
                
                if (selectedStackView?.id === stackId) {
                    setSelectedStackView(updatedStacks.find(s => s.id === stackId));
                }
            };

            const toggleBlock = (stackId) => {
                const updatedStacks = stacks.map(s => 
                    s.id === stackId 
                        ? { ...s, isBlocked: !s.isBlocked }
                        : s
                );
                setStacks(updatedStacks);
                
                if (selectedStackView?.id === stackId) {
                    setSelectedStackView(updatedStacks.find(s => s.id === stackId));
                }
            };

            const removePallet = (stackId, palletId) => {
                const updatedStacks = stacks.map(s => 
                    s.id === stackId 
                        ? { ...s, pallets: s.pallets.filter(p => p.id !== palletId) }
                        : s
                );
                setStacks(updatedStacks);
                
                if (selectedStackView?.id === stackId) {
                    setSelectedStackView(updatedStacks.find(s => s.id === stackId));
                }
            };

            const movePallet = (fromStackId, palletId, toStackId) => {
                const fromStack = stacks.find(s => s.id === fromStackId);
                const toStack = stacks.find(s => s.id === toStackId);
                const pallet = fromStack.pallets.find(p => p.id === palletId);
                
                if (toStack.pallets.length >= 3) {
                    alert('Destination stack is full (max 3 pallets)');
                    return;
                }

                const updatedStacks = stacks.map(s => {
                    if (s.id === fromStackId) {
                        return { ...s, pallets: s.pallets.filter(p => p.id !== palletId) };
                    }
                    if (s.id === toStackId) {
                        return { ...s, pallets: [...s.pallets, pallet] };
                    }
                    return s;
                });
                
                setStacks(updatedStacks);
                setShowMoveModal(false);
                setPalletToMove(null);
                
                if (selectedStackView?.id === fromStackId || selectedStackView?.id === toStackId) {
                    setSelectedStackView(updatedStacks.find(s => s.id === selectedStackView.id));
                }
            };

            const moveEntireStack = (fromStackId, toStackId) => {
                const fromStack = stacks.find(s => s.id === fromStackId);
                const toStack = stacks.find(s => s.id === toStackId);
                
                // Check if destination has enough room
                const totalPallets = fromStack.pallets.length + toStack.pallets.length;
                if (totalPallets > 3) {
                    alert(`Cannot move stack: Destination would have ${totalPallets} pallets (max 3)`);
                    return;
                }

                const updatedStacks = stacks.map(s => {
                    if (s.id === fromStackId) {
                        return { ...s, pallets: [] };
                    }
                    if (s.id === toStackId) {
                        return { ...s, pallets: [...s.pallets, ...fromStack.pallets] };
                    }
                    return s;
                });
                
                setStacks(updatedStacks);
                setShowMoveStackModal(false);
                setStackToMove(null);
                setSelectedStackView(null);
            };

            const moveStack = (fromStackId, toStackId) => {
                const fromStack = stacks.find(s => s.id === fromStackId);
                const toStack = stacks.find(s => s.id === toStackId);
                
                if (toStack.pallets.length > 0) {
                    alert('Destination stack must be empty to move entire stack');
                    return;
                }
                
                if (fromStack.pallets.length === 0) {
                    alert('Source stack is empty - nothing to move');
                    return;
                }

                const updatedStacks = stacks.map(s => {
                    if (s.id === fromStackId) {
                        return { ...s, pallets: [] };
                    }
                    if (s.id === toStackId) {
                        return { ...s, pallets: [...fromStack.pallets] };
                    }
                    return s;
                });
                
                setStacks(updatedStacks);
                setShowMoveStackModal(false);
                setStackToMove(null);
                setSelectedStackView(null);
            };

            const getStackColor = (stack) => {
                if (stack.isBlocked) return 'bg-red-100 border-red-400';
                const count = stack.pallets.length;
                if (count === 0) return 'bg-gray-100 border-gray-300';
                if (count === 1) return 'bg-green-50 border-green-400';
                if (count === 2) return 'bg-yellow-50 border-yellow-400';
                return 'bg-orange-50 border-orange-400';
            };

            const getStackPosition = (index, totalPallets) => {
                if (totalPallets === 1) return 'BOTTOM';
                if (totalPallets === 2) {
                    return index === 0 ? 'BOTTOM' : 'TOP';
                }
                if (totalPallets === 3) {
                    if (index === 0) return 'BOTTOM';
                    if (index === 1) return 'MIDDLE';
                    return 'TOP';
                }
            };

            const getAvailablePositions = (currentPalletCount) => {
                if (currentPalletCount === 0) return ['bottom'];
                if (currentPalletCount === 1) return ['bottom', 'top'];
                if (currentPalletCount === 2) return ['bottom', 'middle', 'top'];
                return [];
            };

            const totalPallets = stacks.reduce((sum, stack) => sum + stack.pallets.length, 0);
            const blockedStacks = stacks.filter(s => s.isBlocked).length;

            // Calculate pallet summary - group by content name
            const getPalletSummary = () => {
                const summary = {};
                
                stacks.forEach(stack => {
                    stack.pallets.forEach(pallet => {
                        const content = pallet.content.trim();
                        if (summary[content]) {
                            summary[content].count++;
                            summary[content].locations.push(stack.name);
                        } else {
                            summary[content] = {
                                count: 1,
                                locations: [stack.name]
                            };
                        }
                    });
                });
                
                // Convert to array and sort by count (descending)
                return Object.entries(summary)
                    .map(([name, data]) => ({ name, ...data }))
                    .sort((a, b) => b.count - a.count);
            };

            const palletSummary = getPalletSummary();

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
                        <div className="text-center max-w-md mx-auto p-6">
                            <Package size={64} className="mx-auto mb-4 text-blue-600 animate-pulse" />
                            <p className="text-xl text-slate-700 font-semibold mb-2">Loading warehouse data...</p>
                            {errorMessage && (
                                <div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-left">
                                    <p className="text-red-800 font-semibold mb-2">{errorMessage}</p>
                                    <p className="text-sm text-red-600">See the GOOGLE-SHEETS-SETUP.md file for instructions.</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            const getConnectionStatusColor = () => {
                if (connectionStatus === 'connected') return 'bg-green-600';
                if (connectionStatus === 'error') return 'bg-red-600';
                return 'bg-yellow-600';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4">
                    <div className="max-w-[1400px] mx-auto">
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-slate-800 flex items-center gap-2">
                                        <Package className="text-blue-600" />
                                        Warehouse Pallet Tracker
                                    </h1>
                                    <p className="text-slate-600 mt-1">
                                        {totalPallets} pallets ‚Ä¢ {stacks.filter(s => s.pallets.length > 0).length} occupied stacks ‚Ä¢ {blockedStacks} blocked
                                    </p>
                                    {lastSync && (
                                        <p className="text-xs text-slate-600 mt-1 flex items-center gap-1">
                                            <span className={`w-2 h-2 ${getConnectionStatusColor()} rounded-full ${connectionStatus === 'connected' ? 'animate-pulse' : ''}`}></span>
                                            {connectionStatus === 'connected' ? `Synced with Google Sheets at ${lastSync}` : 'Reconnecting...'}
                                        </p>
                                    )}
                                    <p className="text-xs text-blue-600 mt-1">
                                        üìä Open your Google Sheet to see/export all data
                                    </p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={() => setShowSummary(true)}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-semibold"
                                    >
                                        <BarChart3 size={20} />
                                        Inventory Summary
                                    </button>
                                    <div className="text-right">
                                        <div className="text-sm text-slate-600 space-y-1">
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-green-50 border-2 border-green-400 rounded"></div>
                                                <span>1 pallet</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-yellow-50 border-2 border-yellow-400 rounded"></div>
                                                <span>2 pallets</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-orange-50 border-2 border-orange-400 rounded"></div>
                                                <span>3 pallets (FULL)</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-red-100 border-2 border-red-400 rounded"></div>
                                                <span>Blocked</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                            <div className="overflow-x-auto">
                                <div className="flex mb-2">
                                    <div className="w-8 flex-shrink-0"></div>
                                    {Array(COLS).fill(null).map((_, i) => (
                                        <div key={i} className="w-14 flex-shrink-0 mx-0.5 text-center text-xs font-bold text-slate-600">
                                            C{i + 1}
                                        </div>
                                    ))}
                                </div>
                                
                                {Array(ROWS).fill(null).map((_, rowIndex) => (
                                    <div key={rowIndex} className="flex mb-2">
                                        <div className="w-8 flex-shrink-0 flex items-center justify-center text-xs font-bold text-slate-600">
                                            R{rowIndex + 1}
                                        </div>
                                        
                                        {stacks.filter(s => s.row === rowIndex + 1).map(stack => (
                                            <div
                                                key={stack.id}
                                                className={`w-14 h-18 flex-shrink-0 mx-0.5 rounded border-2 ${getStackColor(stack)} transition-all hover:shadow-lg relative group cursor-pointer`}
                                                onClick={() => setSelectedStackView(stack)}
                                            >
                                                {stack.isBlocked ? (
                                                    <div className="flex flex-col items-center justify-center h-full text-red-600">
                                                        <Lock size={14} />
                                                        <span className="text-[8px] font-bold mt-0.5">BLOCKED</span>
                                                    </div>
                                                ) : (
                                                    <div className="flex flex-col h-full p-1">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="text-[8px] font-bold text-slate-700">{stack.pallets.length}/3</span>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    toggleBlock(stack.id);
                                                                }}
                                                                className="p-0.5 rounded bg-slate-100 hover:bg-slate-200 opacity-0 group-hover:opacity-100 transition-opacity"
                                                            >
                                                                <Unlock size={8} />
                                                            </button>
                                                        </div>
                                                        
                                                        <div className="flex-1 flex flex-col-reverse gap-0.5">
                                                            {stack.pallets.map((pallet, idx) => (
                                                                <div
                                                                    key={pallet.id}
                                                                    className="bg-blue-500 rounded-sm h-4 flex items-center justify-center cursor-pointer hover:bg-blue-600 px-0.5"
                                                                    title={`${getStackPosition(idx, stack.pallets.length)}: ${pallet.content}`}
                                                                    onClick={() => setSelectedStackView(stack)}
                                                                >
                                                                    <span className="text-[8px] text-white font-bold truncate w-full text-center">
                                                                        {pallet.content.substring(0, 7)}
                                                                    </span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        
                                                        {stack.pallets.length < 3 && (
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    setSelectedStack(stack.id);
                                                                    setSelectedPosition('bottom');
                                                                    setShowAddModal(true);
                                                                }}
                                                                className="w-full mt-1 bg-blue-600 hover:bg-blue-700 text-white py-0.5 rounded text-[8px] opacity-0 group-hover:opacity-100 transition-opacity"
                                                            >
                                                                +
                                                            </button>
                                                        )}
                                                    </div>
                                                )}
                                                
                                                <div className="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-[10px] px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                                                    {stack.name}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Inventory Summary Panel */}
                    {showSummary && (
                        <div className="fixed top-0 left-0 h-full w-96 bg-white shadow-2xl z-50 overflow-y-auto border-r-4 border-green-600">
                            <div className="p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-2">
                                        <BarChart3 className="text-green-600" />
                                        Inventory Summary
                                    </h2>
                                    <button
                                        onClick={() => setShowSummary(false)}
                                        className="text-slate-500 hover:text-slate-700 text-2xl"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="mb-6">
                                    <div className="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg border border-green-200">
                                        <p className="text-sm text-slate-600 mb-1">Total Unique Items</p>
                                        <p className="text-3xl font-bold text-slate-800">{palletSummary.length}</p>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <h3 className="font-bold text-slate-700 mb-3">Pallet Counts by Item:</h3>
                                    {palletSummary.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            <Package size={48} className="mx-auto mb-2 opacity-50" />
                                            <p>No pallets in warehouse</p>
                                        </div>
                                    ) : (
                                        palletSummary.map((item, index) => (
                                            <div
                                                key={index}
                                                className="bg-white border-2 border-slate-200 hover:border-green-400 p-4 rounded-lg transition-all"
                                            >
                                                <div className="flex justify-between items-start mb-2">
                                                    <h4 className="font-semibold text-slate-800 flex-1 pr-2">
                                                        {item.name}
                                                    </h4>
                                                    <span className="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                        {item.count} {item.count === 1 ? 'pallet' : 'pallets'}
                                                    </span>
                                                </div>
                                                <details className="mt-2">
                                                    <summary className="text-xs text-slate-500 cursor-pointer hover:text-slate-700">
                                                        View locations ({item.locations.length} {item.locations.length === 1 ? 'stack' : 'stacks'})
                                                    </summary>
                                                    <div className="mt-2 pl-3 border-l-2 border-slate-200">
                                                        {item.locations.map((location, idx) => (
                                                            <div key={idx} className="text-xs text-slate-600 py-1">
                                                                üìç {location}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </details>
                                            </div>
                                        ))
                                    )}
                                </div>

                                {palletSummary.length > 0 && (
                                    <div className="mt-6 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <p className="text-sm text-slate-600 mb-2">
                                            üí° <strong>Tip:</strong> Click "View locations" to see where each item is stored
                                        </p>
                                        <p className="text-xs text-slate-500">
                                            This summary updates in real-time as you add or remove pallets
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Detail Panel - Same as before */}
                    {selectedStackView && (
                        <div className="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl z-50 overflow-y-auto border-l-4 border-blue-600">
                            <div className="p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-slate-800">{selectedStackView.name}</h2>
                                    <button
                                        onClick={() => setSelectedStackView(null)}
                                        className="text-slate-500 hover:text-slate-700 text-2xl"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="mb-6">
                                    <div className="flex items-center gap-2 text-sm text-slate-600 mb-2">
                                        <span className="font-semibold">Position:</span>
                                        <span>Row {selectedStackView.row}, Column {selectedStackView.col}</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-sm text-slate-600">
                                        <span className="font-semibold">Capacity:</span>
                                        <span>{selectedStackView.pallets.length}/3 pallets</span>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <h3 className="font-bold text-slate-700 mb-2">Pallets in Stack:</h3>
                                    {selectedStackView.pallets.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            <Package size={48} className="mx-auto mb-2 opacity-50" />
                                            <p>No pallets in this stack</p>
                                        </div>
                                    ) : (
                                        selectedStackView.pallets.slice().reverse().map((pallet, displayIndex) => {
                                            const actualIndex = selectedStackView.pallets.length - 1 - displayIndex;
                                            return (
                                                <div
                                                    key={pallet.id}
                                                    className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg shadow-md"
                                                >
                                                    <div className="flex justify-between items-start mb-2">
                                                        <span className="font-bold bg-white/20 px-2 py-1 rounded text-sm">
                                                            {getStackPosition(actualIndex, selectedStackView.pallets.length)}
                                                        </span>
                                                        <div className="flex gap-1">
                                                            {actualIndex > 0 && (
                                                                <button
                                                                    onClick={() => movePalletInStack(selectedStackView.id, pallet.id, 'down')}
                                                                    className="bg-white/20 hover:bg-white/30 p-1.5 rounded"
                                                                    title="Move down"
                                                                >
                                                                    <ArrowDown size={16} />
                                                                </button>
                                                            )}
                                                            {actualIndex < selectedStackView.pallets.length - 1 && (
                                                                <button
                                                                    onClick={() => movePalletInStack(selectedStackView.id, pallet.id, 'up')}
                                                                    className="bg-white/20 hover:bg-white/30 p-1.5 rounded"
                                                                    title="Move up"
                                                                >
                                                                    <ArrowUp size={16} />
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={() => {
                                                                    setPalletToMove({ stackId: selectedStackView.id, pallet });
                                                                    setShowMoveModal(true);
                                                                }}
                                                                className="bg-white/20 hover:bg-white/30 p-1.5 rounded"
                                                                title="Move to different stack"
                                                            >
                                                                <ArrowRight size={16} />
                                                            </button>
                                                            <button
                                                                onClick={() => removePallet(selectedStackView.id, pallet.id)}
                                                                className="bg-white/20 hover:bg-white/30 p-1.5 rounded"
                                                                title="Remove pallet"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <p className="font-semibold text-lg mb-1">{pallet.content}</p>
                                                    <p className="text-xs text-white/80">Added: {pallet.addedAt}</p>
                                                </div>
                                            );
                                        })
                                    )}
                                </div>

                                {selectedStackView.pallets.length < 3 && !selectedStackView.isBlocked && (
                                    <button
                                        onClick={() => {
                                            setSelectedStack(selectedStackView.id);
                                            setSelectedPosition('bottom');
                                            setShowAddModal(true);
                                        }}
                                        className="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg flex items-center justify-center gap-2 transition-colors font-semibold"
                                    >
                                        <Plus size={20} />
                                        Add Pallet to Stack
                                    </button>
                                )}

                                {selectedStackView.pallets.length > 0 && (
                                    <button
                                        onClick={() => {
                                            setStackToMove(selectedStackView.id);
                                            setShowMoveStackModal(true);
                                        }}
                                        className="w-full mt-3 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg flex items-center justify-center gap-2 transition-colors font-semibold"
                                    >
                                        <ArrowRight size={20} />
                                        Move Entire Stack ({selectedStackView.pallets.length} pallets)
                                    </button>
                                )}

                                <button
                                    onClick={() => toggleBlock(selectedStackView.id)}
                                    className={`w-full mt-3 py-3 rounded-lg flex items-center justify-center gap-2 transition-colors font-semibold ${
                                        selectedStackView.isBlocked
                                            ? 'bg-red-500 hover:bg-red-600 text-white'
                                            : 'bg-slate-200 hover:bg-slate-300 text-slate-800'
                                    }`}
                                >
                                    {selectedStackView.isBlocked ? <Unlock size={20} /> : <Lock size={20} />}
                                    {selectedStackView.isBlocked ? 'Unblock Stack' : 'Block Stack'}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Add Modal - Same as before */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4 text-slate-800">
                                    Add Pallet to {stacks.find(s => s.id === selectedStack)?.name}
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">
                                            Pallet Contents
                                        </label>
                                        <input
                                            type="text"
                                            value={newPalletContent}
                                            onChange={(e) => setNewPalletContent(e.target.value)}
                                            placeholder="e.g., Electronics - SKU12345"
                                            className="w-full border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            autoFocus
                                            onKeyPress={(e) => e.key === 'Enter' && addPallet()}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">
                                            Stack Position
                                        </label>
                                        <div className="flex gap-2">
                                            {getAvailablePositions(stacks.find(s => s.id === selectedStack)?.pallets.length || 0).map(pos => (
                                                <button
                                                    key={pos}
                                                    onClick={() => setSelectedPosition(pos)}
                                                    className={`flex-1 py-2 px-3 rounded font-medium transition-all ${
                                                        selectedPosition === pos
                                                            ? 'bg-blue-600 text-white'
                                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                                    }`}
                                                >
                                                    {pos.toUpperCase()}
                                                </button>
                                            ))}
                                        </div>
                                        <p className="text-xs text-slate-500 mt-2">
                                            Select where in the stack to place this pallet
                                        </p>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <button
                                            onClick={addPallet}
                                            className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium transition-colors"
                                        >
                                            Add Pallet
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowAddModal(false);
                                                setNewPalletContent('');
                                                setSelectedPosition('bottom');
                                            }}
                                            className="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-800 py-2 rounded font-medium transition-colors"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Move Modal - Same as before */}
                    {showMoveModal && palletToMove && (
                        <div 
                            className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[60]"
                            onClick={() => {
                                setShowMoveModal(false);
                                setPalletToMove(null);
                            }}
                        >
                            <div 
                                className="bg-white rounded-lg w-full max-w-6xl max-h-[90vh] flex flex-col"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="flex justify-between items-center p-6 border-b border-slate-200 flex-shrink-0">
                                    <div>
                                        <h2 className="text-xl font-bold text-slate-800">
                                            Move Pallet: {palletToMove.pallet.content}
                                        </h2>
                                        <p className="text-sm text-slate-600 mt-1">
                                            Select destination stack ({stacks.filter(s => s.pallets.length < 3 && s.id !== palletToMove.stackId && !s.isBlocked).length} available)
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => {
                                            setShowMoveModal(false);
                                            setPalletToMove(null);
                                        }}
                                        className="text-slate-500 hover:text-slate-700 text-3xl leading-none font-bold"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="overflow-y-auto flex-1 p-6">
                                    <div className="grid grid-cols-6 gap-2">
                                        {stacks.filter(s => s.pallets.length < 3 && s.id !== palletToMove.stackId && !s.isBlocked).map(stack => (
                                            <button
                                                key={stack.id}
                                                onClick={() => movePallet(palletToMove.stackId, palletToMove.pallet.id, stack.id)}
                                                className="bg-slate-100 hover:bg-blue-50 border-2 border-slate-300 hover:border-blue-400 p-3 rounded transition-all text-left"
                                            >
                                                <div className="font-bold text-slate-700 text-sm">{stack.name}</div>
                                                <div className="text-xs text-slate-500 mt-1">
                                                    Row {stack.row}, Col {stack.col}
                                                </div>
                                                <div className="text-xs text-slate-600 font-semibold mt-1">
                                                    {stack.pallets.length}/3 pallets
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="p-4 border-t border-slate-200 flex-shrink-0">
                                    <button
                                        onClick={() => {
                                            setShowMoveModal(false);
                                            setPalletToMove(null);
                                        }}
                                        className="w-full bg-slate-200 hover:bg-slate-300 text-slate-800 py-2 rounded font-medium transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Move Stack Modal */}
                    {showMoveStackModal && stackToMove && (
                        <div 
                            className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[60]"
                            onClick={() => {
                                setShowMoveStackModal(false);
                                setStackToMove(null);
                            }}
                        >
                            <div 
                                className="bg-white rounded-lg w-full max-w-6xl max-h-[90vh] flex flex-col"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="flex justify-between items-center p-6 border-b border-slate-200 flex-shrink-0">
                                    <div>
                                        <h2 className="text-xl font-bold text-slate-800">
                                            Move Entire Stack: {stacks.find(s => s.id === stackToMove)?.name}
                                        </h2>
                                        <p className="text-sm text-slate-600 mt-1">
                                            Moving {stacks.find(s => s.id === stackToMove)?.pallets.length} pallets ‚Ä¢ Select destination with enough space
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => {
                                            setShowMoveStackModal(false);
                                            setStackToMove(null);
                                        }}
                                        className="text-slate-500 hover:text-slate-700 text-3xl leading-none font-bold"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="overflow-y-auto flex-1 p-6">
                                    <div className="grid grid-cols-6 gap-2">
                                        {(() => {
                                            const sourceStack = stacks.find(s => s.id === stackToMove);
                                            const sourcePalletCount = sourceStack?.pallets.length || 0;
                                            return stacks.filter(s => {
                                                const hasRoom = (s.pallets.length + sourcePalletCount) <= 3;
                                                return hasRoom && s.id !== stackToMove && !s.isBlocked;
                                            }).map(stack => (
                                                <button
                                                    key={stack.id}
                                                    onClick={() => moveEntireStack(stackToMove, stack.id)}
                                                    className="bg-slate-100 hover:bg-purple-50 border-2 border-slate-300 hover:border-purple-400 p-3 rounded transition-all text-left"
                                                >
                                                    <div className="font-bold text-slate-700 text-sm">{stack.name}</div>
                                                    <div className="text-xs text-slate-500 mt-1">
                                                        Row {stack.row}, Col {stack.col}
                                                    </div>
                                                    <div className="text-xs text-green-600 font-semibold mt-1">
                                                        {stack.pallets.length === 0 ? '‚úì Empty' : `${stack.pallets.length} pallets ‚Üí ${stack.pallets.length + sourcePalletCount} total`}
                                                    </div>
                                                </button>
                                            ));
                                        })()}
                                    </div>
                                    {(() => {
                                        const sourceStack = stacks.find(s => s.id === stackToMove);
                                        const sourcePalletCount = sourceStack?.pallets.length || 0;
                                        const availableStacks = stacks.filter(s => {
                                            const hasRoom = (s.pallets.length + sourcePalletCount) <= 3;
                                            return hasRoom && s.id !== stackToMove && !s.isBlocked;
                                        });
                                        return availableStacks.length === 0 ? (
                                            <div className="text-center py-12">
                                                <p className="text-slate-500 mb-2">No stacks with enough space available</p>
                                                <p className="text-sm text-slate-400">Need a stack with room for {sourcePalletCount} more pallets</p>
                                            </div>
                                        ) : null;
                                    })()}
                                </div>
                                
                                <div className="p-4 border-t border-slate-200 flex-shrink-0">
                                    <button
                                        onClick={() => {
                                            setShowMoveStackModal(false);
                                            setStackToMove(null);
                                        }}
                                        className="w-full bg-slate-200 hover:bg-slate-300 text-slate-800 py-2 rounded font-medium transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WarehousePalletTracker />);
    </script>
</body>
</html>
